<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Blockchain Tools">
    <meta name="keywords" content="bitcoin transaction decoder, ethereum transaction decoder, solana transaction decoder, sui transaction decoder, blockchain transaction decoder, crypto transaction decoder, transaction analysis tool, raw transaction decoder, hex transaction decoder">
    <title>Blockchain Tools</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .main-container {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding: 20px 0 0 0;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .sidebar h1 {
            margin: 0 20px 30px 20px;
            font-size: 18px;
            color: #ecf0f1;
            border-bottom: 1px solid #34495e;
            padding-bottom: 15px;
        }
        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            border-left: 4px solid transparent;
        }
        .nav-item:hover {
            background-color: #34495e;
        }
        .nav-item.active {
            background-color: #3498db;
            border-left-color: #2980b9;
        }
        .nav-item i {
            margin-right: 10px;
            font-size: 16px;
        }
        .sidebar-footer {
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid #34495e;
            text-align: center;
            font-size: 12px;
            color: #bdc3c7;
        }
        .sidebar-footer a {
            color: #3498db;
            text-decoration: none;
        }
        .sidebar-footer a:hover {
            text-decoration: underline;
        }
        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .section {
            display: none;
            max-width: 800px;
            margin: 0 auto;
        }
        .section.active {
            display: block;
        }
        .section-content {
            padding: 20px;
        }
        .section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }
        
        #mnemonicInput {
            height: 50px;
        }
        .controls {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #45a049;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #output, #mnemonicAddressOutput, #privateKeyAddressOutput, #publicKeyAddressOutput {
            width: 100%;
            height: 400px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: white;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-y: auto;
            resize: vertical;
            min-height: 200px;
        }
        
        #output {
            background-color: white;
        }
        
        #output.error {
            background-color: #f8f8f8;
        }
        #mnemonicAddressOutput, #privateKeyAddressOutput, #publicKeyAddressOutput {
            height: 500px;
        }
        .chain-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .input-method-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }
        .input-method-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            color: #666;
            font-weight: 500;
        }
        .input-method-tab.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
        }
        .input-method-tab:hover {
            color: #4CAF50;
        }
        .input-method-content {
            display: none;
        }
        .input-method-content.active {
            display: block;
        }
        .path-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        .path-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .path-preset {
            padding: 5px 10px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .path-preset:hover {
            background-color: #e0e0e0;
        }
        .path-preset.active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        .converter-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .converter-input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .converter-input-group label {
            font-weight: bold;
            color: #333;
        }
        .converter-textarea {
            width: 100%;
            height: 450px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
            font-family: monospace;
            font-size: 12px;
        }
        .converter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        .converter-select {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
        }
        .error-message {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .success-message {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        select {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
        }
        .private-key-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .address-result {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .address-item {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .address-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .address-value {
            font-family: monospace;
            word-break: break-all;
            color: #007bff;
            font-size: 13px;
            line-height: 1.4;
            background-color: #f1f3f4;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                padding: 10px 0 0 0;
                height: auto;
            }
            .sidebar h1 {
                margin: 0 15px 20px 15px;
                font-size: 16px;
            }
            .nav-item {
                padding: 12px 15px;
            }
            .content-area {
                padding: 15px;
            }
            .sidebar-footer {
                margin-top: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <h1>🔧 Blockchain Tools</h1>
            <div class="nav-item active" onclick="switchSection('decoder')">
                <i>🔍</i>Transaction Decoder
            </div>
            <div class="nav-item" onclick="switchSection('generator')">
                <i>🔑</i>Address Generator
            </div>
            <div class="nav-item" onclick="switchSection('converter')">
                <i>🔄</i>Encoding Converter
            </div>
            <div class="sidebar-footer">
                <p>Author: <a href="https://github.com/10gic" target="_blank" rel="noopener">10gic</a></p>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Transaction Decoder Section -->
            <div id="decoder" class="section active">
                <div class="section-content">
                    <h2>🔍 Transaction Decoder</h2>
                    <div class="input-group">
                        <label for="txInput">Raw Transaction. Now supporting Bitcoin (hex), Ethereum (hex), Solana (base64/base58), Sui (base64):</label>
                        <textarea id="txInput" placeholder="Enter raw transaction here..."></textarea>
                    </div>
                    <div class="controls">
                        <div class="checkbox-group">
                            <input type="checkbox" id="includeDerived" checked>
                            <label for="includeDerived">Include Derived Fields</label>
                        </div>
                        <button onclick="uniDecodeTx()">Decode Transaction</button>
                        <button onclick="generateTestTransactionData()" style="background-color: #6c757d;">Generate Test Data</button>
                    </div>
                    <div class="input-group">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                            <label for="output">Result:</label>
                            <div id="chain-type" style="color: #666; font-size: 0.9em;"></div>
                        </div>
                        <div id="output"></div>
                    </div>
                </div>
            </div>

            <!-- Address Generator Section -->
            <div id="generator" class="section">
                <div class="section-content">
                    <h2>🔑 Address Generator</h2>
                    <div class="warning">
                        ⚠️ <strong>Security Warning:</strong> Never enter your real private keys, mnemonics, or public keys on any website. This tool is for educational purposes only, and never leak your input.
                    </div>
                    
                    <!-- Input Method Tabs -->
                    <div class="input-method-tabs">
                        <button class="input-method-tab active" onclick="switchInputMethod('mnemonic')">Mnemonic</button>
                        <button class="input-method-tab" onclick="switchInputMethod('privateKey')">Private Key</button>
                        <button class="input-method-tab" onclick="switchInputMethod('publicKey')">Public Key</button>
                    </div>
                    
                    <!-- Mnemonic Input Method -->
                    <div id="mnemonic-content" class="input-method-content active">
                        <div class="input-group">
                            <label for="mnemonicInput">Mnemonic Phrase (12, 15, 18, 21, or 24 words):</label>
                            <textarea id="mnemonicInput" class="private-key-input" placeholder="Enter mnemonic phrase (e.g., abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about)"></textarea>
                        </div>
                        
                        <div class="path-input-group">
                            <label for="derivationPath">Derivation Path:</label>
                            <input type="text" id="derivationPath" class="path-input" value="m/44'/60'/0'/0/0" placeholder="m/44'/60'/0'/0/0">
                        </div>
                    </div>
                    
                    <!-- Private Key Input Method -->
                    <div id="privateKey-content" class="input-method-content">
                        <div class="input-group">
                            <label for="privateKeyInput">Private Key:</label>
                            <input type="text" id="privateKeyInput" class="private-key-input" placeholder="Enter private key (e.g., 0x1ab42cc412b618bdea3a599e3c9bae199ebf030895b039e9db1e30dafb12b727)" maxlength="130">
                        </div>
                    </div>
                    
                    <!-- Public Key Input Method -->
                    <div id="publicKey-content" class="input-method-content">
                        <div class="input-group">
                            <label for="publicKeyInput">Public Key:</label>
                            <input type="text" id="publicKeyInput" class="private-key-input" placeholder="Enter public key (e.g., 0x03aaeb52dd7494c361049de67cc680e83ebcbbbdbeb13637d92cd845f70308af5e)" maxlength="130">
                        </div>
                    </div>
                    
                    <div class="chain-selector">
                        <label for="chainSelect">Select Blockchain:</label>
                        <select id="chainSelect" onchange="toggleDerivationPath()">
                            <option value="all">All Chains</option>
                            <option value="ethereum">Ethereum (ETH)</option>
                            <option value="bitcoin">Bitcoin (BTC)</option>
                            <option value="sui">Sui (SUI)</option>
                            <option value="solana">Solana (SOL)</option>
                        </select>
                        <button onclick="generateAddress()">Generate Address</button>
                        <button onclick="generateTestData()" style="background-color: #6c757d;">Generate Test Data</button>
                    </div>
                    
                    <!-- Mnemonic Output -->
                    <div id="mnemonic-output" class="input-group">
                        <label for="mnemonicAddressOutput">Generated Address(es):</label>
                        <div id="mnemonicAddressOutput"></div>
                    </div>
                    
                    <!-- Private Key Output -->
                    <div id="privateKey-output" class="input-group">
                        <label for="privateKeyAddressOutput">Generated Address(es):</label>
                        <div id="privateKeyAddressOutput"></div>
                    </div>
                    
                    <!-- Public Key Output -->
                    <div id="publicKey-output" class="input-group">
                        <label for="publicKeyAddressOutput">Generated Address(es):</label>
                        <div id="publicKeyAddressOutput"></div>
                    </div>
                </div>
            </div>

            <!-- Encoding Converter Section -->
            <div id="converter" class="section">
                <div class="section-content">
                    <h2>🔄 Encoding Converter</h2>

                    <div class="converter-controls">
                        <label for="fromFormat">From:</label>
                        <select id="fromFormat" class="converter-select" onchange="convertEncoding()">
                            <option value="hex">Hex</option>
                            <option value="base58">Base58 (no checksum)</option>
                            <option value="base64">Base64</option>
                            <option value="base64url">Base64 URL safe</option>
                            <option value="uint8array">Uint8 array</option>
                            <option value="utf8">UTF-8</option>
                        </select>
                        <span>→</span>
                        <label for="toFormat">To:</label>
                        <select id="toFormat" class="converter-select" onchange="convertEncoding()">
                            <option value="base64">Base64</option>
                            <option value="hex">Hex</option>
                            <option value="base58">Base58 (no checksum)</option>
                            <option value="base64url">Base64 URL safe</option>
                            <option value="uint8array">Uint8 array</option>
                            <option value="utf8">UTF-8</option>
                        </select>
                        <button onclick="clearConverter()" style="background-color: #6c757d;">Clear</button>
                    </div>
                    
                    <div class="converter-grid">
                        <div class="converter-input-group">
                            <label for="inputText">Input:</label>
                            <textarea id="inputText" class="converter-textarea" placeholder="Enter text to convert..." oninput="convertEncoding()"></textarea>
                        </div>
                        <div class="converter-input-group">
                            <label for="outputText">Output:</label>
                            <textarea id="outputText" class="converter-textarea" placeholder="Converted result will appear here..." readonly></textarea>
                        </div>
                    </div>
                    
                    <div id="converterMessage"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import init, { uni_tx_decode, dump_private_key, dump_public_key, encoding_convert, dump_mnemonics, generate_random_mnemonics, generate_random_private_key } from './pkg/blockchain_tools.js';

        let wasmModule = null;

        async function initWasm() {
            try {
                wasmModule = await init();
                console.log('WASM module initialized successfully');
            } catch (error) {
                console.error('Failed to initialize WASM module:', error);
                document.getElementById('output').textContent = 'Error: Failed to initialize WASM module';
            }
        }

        window.switchSection = function(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked nav item
            event.target.closest('.nav-item').classList.add('active');
            
            // Update URL with anchor
            const newUrl = window.location.pathname + '#' + sectionId;
            window.history.pushState({section: sectionId}, '', newUrl);
        };

        // Handle browser back/forward buttons
        window.addEventListener('popstate', function(event) {
            const sectionId = event.state ? event.state.section : getSectionFromHash();
            switchToSection(sectionId);
        });

        // Function to switch section without updating URL (used internally)
        function switchToSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to corresponding nav item
            const navItems = document.querySelectorAll('.nav-item');
            if (sectionId === 'decoder') {
                navItems[0].classList.add('active');
            } else if (sectionId === 'generator') {
                navItems[1].classList.add('active');
            } else if (sectionId === 'converter') {
                navItems[2].classList.add('active');
            }
        }

        // Function to get section from URL hash
        function getSectionFromHash() {
            const hash = window.location.hash.substring(1);
            if (hash === 'generator') {
                return 'generator';
            } else if (hash === 'converter') {
                return 'converter';
            }
            return 'decoder'; // default
        }

        // Initialize section based on URL hash on page load
        function initializeSection() {
            const sectionId = getSectionFromHash();
            switchToSection(sectionId);
            
            // Update URL if no hash present
            if (!window.location.hash) {
                const newUrl = window.location.pathname + '#' + sectionId;
                window.history.replaceState({section: sectionId}, '', newUrl);
            }
        }

        // Call initialization when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeSection();
            // Initialize derivation path visibility
            toggleDerivationPath();
            // Initialize output areas - show mnemonic output by default
            document.getElementById('mnemonic-output').style.display = 'block';
            document.getElementById('privateKey-output').style.display = 'none';
            document.getElementById('publicKey-output').style.display = 'none';
            // Initialize Generate Test Data button visibility (should be visible by default for mnemonic tab)
            const testDataButton = document.querySelector('button[onclick="generateTestData()"]');
            if (testDataButton) {
                testDataButton.style.display = 'inline-block';
            }
        });

        window.uniDecodeTx = async function() {
            if (!wasmModule) {
                document.getElementById('output').innerHTML = '<div class="error-message">Error: WASM module not initialized</div>';
                return;
            }

            const txInput = document.getElementById('txInput').value.trim();
            const includeDerived = document.getElementById('includeDerived').checked;
            const chainType = document.getElementById('chain-type');
            const output = document.getElementById('output');

            if (!txInput) {
                output.innerHTML = '<div class="error-message">Please enter a transaction.</div>';
                return;
            }

            try {
                const result = uni_tx_decode(txInput, includeDerived);
                const [chainTypeText, txOutput] = result.split('|');
                chainType.textContent = chainTypeText;
                
                // Check if the output looks like an error
                if (txOutput && (txOutput.toLowerCase().startsWith('error') || txOutput.toLowerCase().includes('failed'))) {
                    output.innerHTML = `<div class="error-message">${txOutput}</div>`;
                } else {
                    // Clear any previous error styling
                    output.className = '';
                    try {
                        // Try to parse and format the JSON
                        const jsonObj = JSON.parse(txOutput);
                        output.textContent = JSON.stringify(jsonObj, null, 2);
                    } catch (e) {
                        // If parsing fails, show the raw output
                        output.textContent = txOutput;
                    }
                }
            } catch (error) {
                chainType.textContent = '';
                output.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
            }
        };

        window.generateAddress = function() {
            const activeMethod = document.querySelector('.input-method-tab.active').textContent.toLowerCase();
            const chainSelect = document.getElementById('chainSelect').value;
            
            // Map the active method to the correct output ID
            let outputId;
            if (activeMethod === 'mnemonic') {
                outputId = 'mnemonicAddressOutput';
            } else if (activeMethod === 'private key') {
                outputId = 'privateKeyAddressOutput';
            } else if (activeMethod === 'public key') {
                outputId = 'publicKeyAddressOutput';
            } else {
                console.error('Unknown active method:', activeMethod);
                return;
            }
            
            const addressOutput = document.getElementById(outputId);

            // Check if output element exists
            if (!addressOutput) {
                console.error('Output element not found:', outputId);
                console.error('Active method:', activeMethod);
                return;
            }

            // Check if WASM module is initialized
            if (!wasmModule) {
                addressOutput.innerHTML = '<div class="error-message">Error: WASM module not initialized</div>';
                return;
            }

            let inputData = '';
            const selectedChain = chainSelect === 'all' ? 'all' : chainSelect;

            // Get input data based on active method
            if (activeMethod === 'mnemonic') {
                inputData = document.getElementById('mnemonicInput').value.trim();
                const derivationPath = document.getElementById('derivationPath').value.trim();
                
                if (!inputData) {
                    addressOutput.innerHTML = '<div class="error-message">Please enter a mnemonic phrase.</div>';
                    return;
                }
                
                // Only validate derivation path if not selecting all chains
                if (chainSelect !== 'all' && !derivationPath) {
                    addressOutput.innerHTML = '<div class="error-message">Please enter a derivation path.</div>';
                    return;
                }
                
                // Validate mnemonic (basic check for word count)
                const words = inputData.split(/\s+/);
                if (![12, 15, 18, 21, 24].includes(words.length)) {
                    addressOutput.innerHTML = '<div class="error-message">Mnemonic must contain 12, 15, 18, 21, or 24 words.</div>';
                    return;
                }
                
                // Call Rust dump_mnemonics function
                try {
                    const pathToUse = chainSelect === 'all' ? '' : derivationPath;
                    const result = dump_mnemonics(selectedChain, inputData, pathToUse);
                    
                    // Parse the result
                    const jsonResult = JSON.parse(result);
                    
                    if (jsonResult.error) {
                        addressOutput.innerHTML = `<div class="error-message">Error: ${jsonResult.error}</div>`;
                        return;
                    }
                    
                    const addressData = JSON.parse(jsonResult.result);

                    // Display the results
                    let resultHtml = '<div class="address-result">';

                    addressData.forEach(item => {
                        resultHtml += '<div class="address-item">';
                        resultHtml += `<div class="address-label">${item.name}</div>`;

                        resultHtml += `<div style="margin: 5px 0; font-size: 0.85em; color: #666;">Path: <code>${item.path}</code></div>`;

                        // Add private key type adn private key (optional)
                        if (item.private_key_type && item.private_key_type.length > 0) {
                            item.private_key_type.forEach(
                                (typ, index) => {
                                    resultHtml += `<div style="margin: 5px 0; font-size: 0.85em; color: #666;">Private Key Format: <code>${typ}</code></div>`;
                                    resultHtml += `<div style="margin: 5px 0; font-size: 0.85em; color: #666;">Private Key: <code>${item.private_key[index]}</code></div>`;
                                }
                            )
                        }

                        // Add public key type (optional)
                        if (item.public_key_type && item.public_key_type.length > 0) {
                            resultHtml += `<div style="margin: 5px 0; font-size: 0.85em; color: #666;">Public Key Format: <code>${item.public_key_type[0]}</code></div>`;
                        }

                        // Add public key (optional)
                        if (item.public_key && item.public_key.length > 0) {
                            resultHtml += `<div style="margin: 5px 0; font-size: 0.85em; color: #666;">Public Key: <code>${item.public_key[0]}</code></div>`;
                        }

                        resultHtml += `<div class="address-value">${item.address}</div>`;

                        resultHtml += '</div>';
                    });
                    
                    resultHtml += '</div>';
                    addressOutput.innerHTML = resultHtml;
                    
                } catch (error) {
                    addressOutput.innerHTML = `<div class="error-message">Error generating addresses: ${error.message}</div>`;
                }
                
            } else if (activeMethod === 'private key') {
                inputData = document.getElementById('privateKeyInput').value.trim();

                if (!inputData) {
                    addressOutput.innerHTML = '<div class="error-message">Please enter a private key.</div>';
                    return;
                }

                // For private key, call WASM function
                try {
                    const result = dump_private_key(selectedChain, inputData);
                    // Parse the result
                    const jsonResult = JSON.parse(result);

                    if (jsonResult.error) {
                        addressOutput.innerHTML = `<div class="error-message">Error: ${jsonResult.error}</div>`;
                        return;
                    }

                    const addressData = JSON.parse(jsonResult.result);

                    // Display the results
                    let resultHtml = '<div class="address-result">';

                    addressData.forEach(item => {
                        resultHtml += '<div class="address-item">';
                        resultHtml += `<div class="address-label">${item.name}</div>`;

                        // Add private key type adn private key (optional)
                        if (item.private_key_type && item.private_key_type.length > 0) {
                            item.private_key_type.forEach(
                                (typ, index) => {
                                    resultHtml += `<div style="margin: 5px 0; font-size: 0.85em; color: #666;">Private Key Format: <code>${typ}</code></div>`;
                                    resultHtml += `<div style="margin: 5px 0; font-size: 0.85em; color: #666;">Private Key: <code>${item.private_key[index]}</code></div>`;
                                }
                            )
                        }

                        // Add public key type (optional)
                        if (item.public_key_type && item.public_key_type.length > 0) {
                            resultHtml += `<div style="margin: 5px 0; font-size: 0.85em; color: #666;">Public Key Format: <code>${item.public_key_type[0]}</code></div>`;
                        }

                        // Add public key (optional)
                        if (item.public_key && item.public_key.length > 0) {
                            resultHtml += `<div style="margin: 5px 0; font-size: 0.85em; color: #666;">Public Key: ${item.public_key[0]}</div>`;
                        }

                        resultHtml += `<div class="address-value">${item.address}</div>`;

                        resultHtml += '</div>';
                    });

                    resultHtml += '</div>';
                    addressOutput.innerHTML = resultHtml;

                } catch (error) {
                    addressOutput.innerHTML = `<div class="error-message">Error generating addresses: ${error.message}</div>`;
                }
                
            } else if (activeMethod === 'public key') {
                inputData = document.getElementById('publicKeyInput').value.trim();

                if (!inputData) {
                    addressOutput.innerHTML = '<div class="error-message">Please enter a public key.</div>';
                    return;
                }

                // For public key, call WASM function
                try {
                    const result = dump_public_key(selectedChain, inputData);
                    // Parse the result
                    const jsonResult = JSON.parse(result);

                    if (jsonResult.error) {
                        addressOutput.innerHTML = `<div class="error-message">Error: ${jsonResult.error}</div>`;
                        return;
                    }

                    const addressData = JSON.parse(jsonResult.result);

                    // Display the results
                    let resultHtml = '<div class="address-result">';

                    addressData.forEach(item => {
                        resultHtml += '<div class="address-item">';
                        resultHtml += `<div class="address-label">${item.name}</div>`;

                        // Add public key type (optional)
                        if (item.public_key_type && item.public_key_type.length > 0) {
                            resultHtml += `<div style="margin: 5px 0; font-size: 0.85em; color: #666;">Public Key Format: <code>${item.public_key_type[0]}</code></div>`;
                        }

                        // Add public key (optional)
                        if (item.public_key && item.public_key.length > 0) {
                            resultHtml += `<div style="margin: 5px 0; font-size: 0.85em; color: #666;">Public Key: <code>${item.public_key[0]}</code></div>`;
                        }

                        resultHtml += `<div class="address-value">${item.address}</div>`;

                        resultHtml += '</div>';
                    });

                    resultHtml += '</div>';
                    addressOutput.innerHTML = resultHtml;

                } catch (error) {
                    addressOutput.innerHTML = `<div class="error-message">Error generating addresses: ${error.message}</div>`;
                }
            }
        };

        window.switchInputMethod = function(method) {
            // Hide all input method contents
            document.querySelectorAll('.input-method-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Hide all output areas
            document.querySelectorAll('#mnemonic-output, #privateKey-output, #publicKey-output').forEach(output => {
                output.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.input-method-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected content
            document.getElementById(method + '-content').classList.add('active');
            
            // Show corresponding output area
            document.getElementById(method + '-output').style.display = 'block';
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Show/hide Generate Test Data button based on method
            const testDataButton = document.querySelector('button[onclick="generateTestData()"]');
            if (testDataButton) {
                if (method === 'publicKey') {
                    testDataButton.style.display = 'none';
                } else {
                    testDataButton.style.display = 'inline-block';
                }
            }
        };

        window.toggleDerivationPath = function() {
            const chainSelect = document.getElementById('chainSelect').value;
            const pathInputGroup = document.querySelector('.path-input-group');
            
            if (chainSelect === 'all') {
                pathInputGroup.style.display = 'none';
            } else {
                pathInputGroup.style.display = 'flex';
                // Auto-set the path based on selected chain
                const chainInfo = getChainInfo(chainSelect);
                document.getElementById('derivationPath').value = chainInfo.path;
            }
        };

        window.setPathPreset = function(path, element) {
            document.getElementById('derivationPath').value = path;
            
            // Remove active class from all presets
            document.querySelectorAll('.path-preset').forEach(preset => {
                preset.classList.remove('active');
            });
            
            // Add active class to clicked preset
            element.classList.add('active');
        };

        window.generateTestData = function() {
            if (!wasmModule) {
                alert('Error: WASM module not initialized');
                return;
            }

            const activeMethod = document.querySelector('.input-method-tab.active').textContent.toLowerCase();
            
            if (activeMethod === 'mnemonic') {
                // Generate test mnemonic (12 words)
                const result = generate_random_mnemonics(12);
                const jsonResult = JSON.parse(result);
                if (jsonResult.error) {
                    alert(`Error: ${jsonResult.error}`);
                } else {
                    document.getElementById('mnemonicInput').value = jsonResult.result;
                }
            } else if (activeMethod === 'private key') {
                // Generate test mnemonic (12 words)
                const result = generate_random_private_key();
                const jsonResult = JSON.parse(result);
                if (jsonResult.error) {
                    alert(`Error: ${jsonResult.error}`);
                } else {
                    document.getElementById('privateKeyInput').value = jsonResult.result;
                }
            }
        };

        window.generateTestTransactionData = function() {
            const testTransaction = "0x02f8710102830970188416aff9cd825208949944a69089a39cb719b8533cc892e133e3a80a07880813c5744877d10080c001a06d43253d95593a170b4e697549e77ee218e015a4527a00dfa3802d29d89f9e83a0644ae294c5d4ee61f3807e8898c8ba1360ff555d1f0521de44dc7dd788f6e44e";
            document.getElementById('txInput').value = testTransaction;
        };

        // Encoding conversion functions
        window.convertEncoding = function() {
            if (!wasmModule) {
                document.getElementById('outputText').value = '';
                document.getElementById('converterMessage').innerHTML = '<div class="error-message">Error: WASM module not initialized</div>';
                return;
            }

            const input = document.getElementById('inputText').value.trim();
            const fromFormat = document.getElementById('fromFormat').value;
            const toFormat = document.getElementById('toFormat').value;
            const output = document.getElementById('outputText');
            const message = document.getElementById('converterMessage');

            if (!input) {
                output.value = '';
                message.innerHTML = '';
                return;
            }

            try {
                const result = encoding_convert(input, fromFormat, toFormat);
                const jsonResult = JSON.parse(result);
                
                if (jsonResult.error) {
                    output.value = '';
                    message.innerHTML = `<div class="error-message">✗ Error: ${jsonResult.error}</div>`;
                } else {
                    output.value = jsonResult.result;
                    message.innerHTML = '<div class="success-message">✓ Conversion successful</div>';
                }
            } catch (error) {
                output.value = '';
                message.innerHTML = `<div class="error-message">✗ Error: ${error.message}</div>`;
            }
        };

        window.clearConverter = function() {
            document.getElementById('inputText').value = '';
            document.getElementById('outputText').value = '';
            document.getElementById('converterMessage').innerHTML = '';
        };

        // Chain information and helper functions
        function getChainInfo(chainId) {
            const chains = {
                'ethereum': {
                    path: 'm/44\'/60\'/0\'/0/0',
                },
                'bitcoin': {
                    path: 'm/44\'/0\'/0\'/0/0, m/49\'/0\'/0\'/0/0, m/84\'/0\'/0\'/0/0, m/86\'/0\'/0\'/0/0',
                },
                'sui': {
                    path: 'm/44\'/784\'/0\'/0\'/0\'',
                },
                'solana': {
                    path: 'm/44\'/501\'/0\'/0\', m/44\'/501\'/0\'',
                }
            };
            return chains[chainId];
        }

        // Initialize WASM module when the page loads
        initWasm();
    </script>
</body>
</html> 